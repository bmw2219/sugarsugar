<!DOCTYPE html>
<html style="padding:0;margin:0;">
	<body style="padding:0;margin:0;overflow: hidden;">
		<canvas id="screen"></canvas>
		<script>
			canvascolor = "rgba(19, 23, 26, 1)";
			var canvas = document.getElementById('screen');
			var ctx = canvas.getContext('2d');
			var sugars = [];
			var scrollnumber = 1;
			canvasResize();

/*
			var column = [];
			var arry = [];
			for(var i = 0; i < canvas.height/3-10; i++){
				column.push(0);
			}
			column.push(1);
			for(var i = 0; i < canvas.width/3; i++){
				arry.push(column);
			}
*/

			var arry = Array(Math.round(canvas.width/3));

			arry[0] = Array(Math.round(canvas.height/3-10));
			for(var j=0; j<Math.round(canvas.height/3-10); ++j){
				arry[0][j] = true;
				arry[0].push(true);
			}
			for(var i=1; i<Math.round(canvas.width/3); ++i) {
			  arry[i] = Array(Math.round(canvas.height/3-10));
			  for(var j=0; j<Math.round(canvas.height/3-10); ++j){
			  	arry[i][j] = false;
					arry[i].push(true);
				}
			}
			arry[Math.round(canvas.width/3)] = Array(Math.round(canvas.height/3-10));
			for(var j=0; j<Math.round(canvas.height/3-10); ++j){
				arry[Math.round(canvas.width/3)][j] = true;
				arry[Math.round(canvas.width/3)].push(true);
			}

			console.log(canvas.width, canvas.height, arry.length, arry[1].length)

			canvas.addEventListener('mousedown', onClick);
			canvas.addEventListener("mouseup", onRelease);
			canvas.addEventListener("wheel", scroll)
			function onClick(event){
				var x = Math.round(event.clientX/3);
				var y = Math.round(event.clientY/3);
				arry[x][y] = 1;
				sugr = new Sugr(x, y);
				sugars.push(sugr);
			}

			function onRelease(event){
			}

			class Sugr{
				constructor(x, y){
					this.x = x;
					this.y = y;
					this.color = "rgba(255, 255, 255, 1)";
				}
				calc(){
					//console.log(arry[this.x][this.y+1], this.y);
					var tests = []
					var directions = [
						[-1, 0], // left
						[1, 0],  // right
						[-1, 1],  // bottom left
						[1, 1],  // bottom right
						[0, 1]   // down
					]
					arry[this.x][this.y] = false;
					for(var i=0; i<5; i++){
						var dir = arry[this.x+directions[i][0]][this.y+directions[i][1]];
						//console.log(dir);
						if(!dir){
							tests[i] = false;
						} else if(dir){
							tests[i] = true;
						} else{
							console.log("direction read error, index:", i)
						}
					}
					if(tests[4]==false){
						this.color = "rgba(255, 160, 160, 1)";
						this.y += 1
					} else{
						this.color = "rgba(160, 255, 160, 1)";
					}
					/*
					if(arry[this.x][this.y+1] == 0){
						this.color = "rgba(255, 160, 160, 1)";
						this.y += 1;
						if(arry[this.x+1][this.y] == 0 && arry[this.x-1][this.y] == 0){ //add them and switch case?
							var rand = Math.random();
							if(rand < 0.14){
								this.x -= 1;
							} else if(rand > 0.86){
								this.x += 1;
							}
						}
					} else if(arry[this.x][this.y+1] == 1){
						this.color = "rgba(160, 255, 160, 1)";
					}
					*/
					arry[this.x][this.y] = true;
				}
				draw(){
					var color = this.color
					ctx.fillStyle = color;
					ctx.fillRect((this.x)*3-1, (this.y)*3-1, 3, 3);
					// console.log("sugardrawn");
				}
			}
			function makesugar(x, y, amt){
				if(amt<=-1){
				//console.log(mouseX, mouseY)
					for(var i = 0; i < scrollnumber; i++){
						sugr = new Sugr(x, y);

						if(20>x){
							x = 20;
						} else if(x>canvas.width-20) {
							x = canvas.width-20;
						}
						if(20>y){
							y = 20;
						} else if(y>canvas.height-20) {
							y = canvas.height-20;
						}
						var gridx = Math.round((x + Math.random()*20-10)/3);
						var gridy = Math.round((y + Math.random()*20-10)/3);
						sugr.x = gridx;
						sugr.y = gridy;
						arry[gridx][gridy] = 1;
						sugars.push(sugr);
						if(sugars.length>1000){
							sugars.shift();
						}
					}
				} else if(amt>=1){
					if(sugars.length>0){
						for(var i = 0; i < scrollnumber; i++){
							sugars.shift();
							if(sugars.length==0){
								break;
							}
						}

					}
				}
			}
			setInterval(function(){
				ctx.fillStyle = canvascolor;
				ctx.fillRect(0, 0, canvas.width, canvas.height);
				for(var sgr of sugars){
				    sgr.draw();
						sgr.calc();
				}
			}, 25);

			function scroll(event){
				makesugar(event.clientX, event.clientY, event.deltaX + event.deltaY + event.deltaZ);
			 }


			window.onresize = canvasResize;
			function canvasResize() {
			  canvas.width  = window.innerWidth;
			  canvas.height = window.innerHeight;
			  ctx.fillStyle = '#13171A';
			  //ctx.fillStyle = canvascolor;
			  ctx.fillRect(0, 0, canvas.width, canvas.height);
			}

		</script>
	</body>
</html>
